<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lupa Password - SportifyField</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo">
                    <img src="Asset/Navbar.png" alt="SportifyField Logo" class="logo-img">
                    <span class="logo-text">SportifyField</span>
                </div>
                <nav class="nav-menu">
                    <a href="index.html" class="nav-link">Beranda</a>
                    <a href="lapangan.html" class="nav-link">Lapangan</a>
                </nav>
                <div class="nav-actions">
                    <!-- Content will be injected by nav.js -->
                    <a href="login.html" class="nav-link active">Login</a>
                    <a href="register.html" class="btn-register">Register</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Forgot Password Section -->
    <section class="login-section">
        <div class="container">
            <div class="login-card">
                <div class="login-icon-wrapper">
                    <div class="login-icon">
                        <img src="Asset/Navbar.png" alt="SportifyField Logo" class="login-icon-img">
                    </div>
                </div>

                <h2 class="login-title">Lupa Password?</h2>
                <p class="login-subtitle">Masukkan email Anda dan kami akan mengirimkan link untuk reset password</p>

                <!-- Success Message (hidden by default) -->
                <div id="successMessage" class="alert-message alert-success" style="display: none;">
                    <i class="fas fa-check-circle"></i>
                    <span>Email reset password telah dikirim! Silakan cek inbox atau folder spam Anda.</span>
                </div>

                <!-- Error Message (hidden by default) -->
                <div id="errorMessage" class="alert-message alert-error" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="errorText">Terjadi kesalahan</span>
                </div>

                <div class="login-form" id="resetForm">
                    <div class="form-group">
                        <div class="input-wrapper">
                            <i class="fas fa-envelope input-icon"></i>
                            <input type="email" id="email" placeholder="your@email.com" required>
                        </div>
                    </div>

                    <button type="button" id="resetBtn" class="btn-login">
                        <span id="btnText">Kirim Link Reset</span>
                        <i id="btnLoader" class="fas fa-spinner fa-spin" style="display: none;"></i>
                    </button>
                </div>

                <div class="login-footer">
                    <p class="register-text">
                        Ingat password Anda? <a href="login.html" class="register-link">Login di sini</a>
                    </p>
                    <a href="index.html" class="back-link">Kembali ke Beranda</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p style="text-align:center;">Â© 2024 SportifyField</p>
        </div>
    </footer>

    <!-- FIREBASE RESET PASSWORD SCRIPT -->
    <script type="module">
        import { resetPassword, onAuthStateChange } from "./auth.js";
        import { initNavigation } from "./nav.js";

        // Initialize Navigation UI
        initNavigation();

        // If already logged in, redirect to dashboard
        onAuthStateChange((user) => {
            if (user) {
                window.location.href = "dashboard.html";
            }
        });

        const resetBtn = document.getElementById("resetBtn");
        const btnText = document.getElementById("btnText");
        const btnLoader = document.getElementById("btnLoader");
        const successMessage = document.getElementById("successMessage");
        const errorMessage = document.getElementById("errorMessage");
        const errorText = document.getElementById("errorText");
        const resetForm = document.getElementById("resetForm");

        resetBtn.addEventListener("click", async () => {
            const email = document.getElementById("email").value.trim();

            // Hide previous messages
            successMessage.style.display = "none";
            errorMessage.style.display = "none";

            if (!email) {
                errorText.textContent = "Harap masukkan email Anda";
                errorMessage.style.display = "flex";
                return;
            }

            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                errorText.textContent = "Format email tidak valid";
                errorMessage.style.display = "flex";
                return;
            }

            // Show loading state
            btnText.textContent = "Mengirim...";
            btnLoader.style.display = "inline-block";
            resetBtn.disabled = true;

            try {
                await resetPassword(email);

                // Show success message
                successMessage.style.display = "flex";
                resetForm.style.display = "none";

            } catch (error) {
                console.error("Reset password error:", error.code, error.message);

                let message = "Gagal mengirim email reset password";

                if (error.code === "auth/user-not-found") {
                    message = "Email tidak terdaftar";
                } else if (error.code === "auth/invalid-email") {
                    message = "Format email tidak valid";
                } else if (error.code === "auth/too-many-requests") {
                    message = "Terlalu banyak percobaan. Silakan coba lagi nanti";
                } else if (error.code === "auth/network-request-failed") {
                    message = "Koneksi internet bermasalah";
                }

                errorText.textContent = message;
                errorMessage.style.display = "flex";
            } finally {
                // Reset button state
                btnText.textContent = "Kirim Link Reset";
                btnLoader.style.display = "none";
                resetBtn.disabled = false;
            }
        });

        // Allow Enter key to submit
        document.getElementById("email").addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
                resetBtn.click();
            }
        });
    </script>

    <script src="script.js"></script>
</body>

</html>